<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÙƒÙ…Ø´ÙƒØ§Ø© | Ù…Ø¹Ø±Ø¶ Ø§Ù„ØªØµÙ…ÙŠÙ…Ø§Øª</title>
    <link rel="icon" type="image/png" href="images/ui/logo.png">
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    
    <script src="js/auth.js"></script>
    <script src="js/main.js"></script>
</head>
<body data-page="gallery">
    <div class="fixed-bg"><img src="images/ui/bg.jpg" onerror="this.style.display='none'"></div>
    <div id="header-ph"></div> 

    <!-- Lightbox -->
    <div id="lightbox" onclick="closeLightbox()" class="fixed inset-0 z-[9999] hidden bg-black/95 backdrop-blur-md flex items-center justify-center p-2">
        <button class="absolute top-5 right-5 bg-white/10 text-white p-3 rounded-full hover:bg-white/20 transition z-50">
            <i data-lucide="x" class="w-6 h-6"></i>
        </button>
        <img id="lightbox-img" src="" class="max-h-[90vh] max-w-full rounded-lg shadow-2xl object-contain" onclick="event.stopPropagation()">
        <a id="lightbox-download" href="#" download class="absolute bottom-8 bg-emerald-600 text-white px-8 py-3 rounded-full font-bold shadow-2xl flex items-center gap-2 hover:bg-emerald-700 transition transform hover:scale-105" onclick="event.stopPropagation()">
            <i data-lucide="download" class="w-5 h-5"></i> ØªØ­Ù…ÙŠÙ„
        </a>
    </div>

    <main class="pt-32 px-4 container mx-auto min-h-screen pb-12">
        <div class="text-center mb-12 fade-in">
            <h1 class="text-3xl md:text-5xl font-black text-emerald-900 mb-2">Ù…Ø¹Ø±Ø¶ Ø§Ù„ØªØµÙ…ÙŠÙ…Ø§Øª</h1>
            <p class="text-slate-600 font-bold text-lg">Ø¥Ø¨Ø¯Ø§Ø¹ Ù…ØªØ¬Ø¯Ø¯ . Ù„Ù…Ø³Ø© ÙÙ†ÙŠØ©</p>
        </div>

        <div id="gallery-grid" class="masonry-grid"></div>

        <div class="text-center mt-12">
            <button id="load-more-gallery" class="bg-white text-emerald-800 px-8 py-3 rounded-full font-bold hover:bg-emerald-50 transition border border-emerald-200 shadow-md inline-flex items-center gap-2">
                Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø²ÙŠØ¯ <i data-lucide="arrow-down" class="w-5 h-5"></i>
            </button>
        </div>
    </main>

    <div id="footer-ph"></div>

    <script>
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø¹Ø±Ø¶
        let visibleGalleryCount = 0;
        const GALLERY_INCREMENT = 12; // Ø¹Ø¯Ø¯ Ø§Ù„ØµÙˆØ± Ø§Ù„Ù„ÙŠ Ø¨ØªØ¸Ù‡Ø± ÙÙŠ ÙƒÙ„ Ù…Ø±Ø©
        const MAX_IMAGES = 50; // ğŸ‘ˆ ØºÙŠØ± Ø§Ù„Ø±Ù‚Ù… Ø¯Ù‡ Ù„Ø¹Ø¯Ø¯ Ø§Ù„ØµÙˆØ± Ø§Ù„ÙƒÙ„ÙŠ Ø§Ù„Ù„ÙŠ Ø¹Ù†Ø¯Ùƒ (Ù…Ø«Ù„Ø§Ù‹ Ù„Ùˆ Ø¹Ù†Ø¯Ùƒ 100 ØµÙˆØ±Ø© Ø®Ù„ÙŠÙ‡Ø§ 100)

        document.addEventListener('DOMContentLoaded', () => {
            const grid = document.getElementById('gallery-grid');
            if(grid) grid.innerHTML = '';
            loadGalleryBatch();

            document.getElementById('load-more-gallery').addEventListener('click', () => {
                loadGalleryBatch();
            });
            
            if (typeof lucide !== 'undefined') lucide.createIcons();
        });

        function loadGalleryBatch() {
            const grid = document.getElementById('gallery-grid');
            const btn = document.getElementById('load-more-gallery');
            
            // Ø­Ø³Ø§Ø¨ Ø¨Ø¯Ø§ÙŠØ© ÙˆÙ†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¯ÙØ¹Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            let start = visibleGalleryCount + 1; 
            let end = start + GALLERY_INCREMENT - 1;

            // Ù„Ùˆ ÙˆØµÙ„Ù†Ø§ Ù„Ø¢Ø®Ø± Ø§Ù„ØµÙˆØ±ØŒ Ù†Ø®ÙÙŠ Ø²Ø±Ø§Ø± "Ø§Ù„Ù…Ø²ÙŠØ¯"
            if (start > MAX_IMAGES) {
                if(btn) btn.style.display = 'none';
                return;
            }
            // Ù„Ùˆ Ø§Ù„Ø¯ÙØ¹Ø© Ù‡ØªØ¹Ø¯ÙŠ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ØŒ Ù†ÙˆÙ‚Ù Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰
            if (end > MAX_IMAGES) {
                end = MAX_IMAGES;
                if(btn) btn.style.display = 'none';
            }

            let html = '';
            for(let i=start; i<=end; i++) {
                // ğŸ‘‡ Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø¨Ø³ÙŠØ·: images/1.webp
                const imgSrc = `images/${i}.webp`;
                
                // ÙƒÙˆØ¯ Ø§Ù„Ø·ÙˆØ§Ø±Ø¦: Ù„Ùˆ Ù…Ù„Ù‚Ø§Ø´ .webp ÙŠØ¬Ø±Ø¨ .jpgØŒ ÙˆÙ„Ùˆ Ù…Ù„Ù‚Ø§Ø´ ÙŠØ­Ø· ØµÙˆØ±Ø© Ù…Ù„ÙˆÙ†Ø©
                const fallbackLogic = `this.onerror=null; this.src='images/${i}.jpg'; this.onerror=function(){ this.src='https://placehold.co/600x800/dcfce7/065f46?text=Image+${i}'; }`;

                html += `
                <div class="break-inside-avoid mb-6 glass-panel rounded-2xl overflow-hidden group relative bg-white/40 border border-white hover:shadow-xl transition duration-300">
                    <div class="cursor-pointer relative" onclick="openGalleryLightbox('${imgSrc}')">
                        
                        <img src="${imgSrc}" loading="lazy" class="w-full h-auto block transform transition duration-500 group-hover:scale-105" 
                             onerror="${fallbackLogic}">
                        
                        <div class="absolute inset-0 bg-emerald-900/20 opacity-0 group-hover:opacity-100 transition duration-300 flex items-center justify-center">
                            <div class="bg-white/90 text-emerald-900 p-3 rounded-full shadow-lg transform scale-75 group-hover:scale-100 transition">
                                <i data-lucide="zoom-in" class="w-6 h-6"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="p-3 flex justify-between items-center bg-white/80 backdrop-blur-md border-t border-white/50">
                        <button onclick="toggleLike(${i})" class="flex items-center gap-1.5 text-slate-500 hover:text-red-500 transition group/like">
                            <i data-lucide="heart" class="w-5 h-5 transition transform group-active/like:scale-125" id="heart-${i}"></i>
                            <span id="likes-count-${i}" class="text-xs font-bold font-sans mt-0.5">0</span>
                        </button>

                        <button onclick="shareGalleryImage('${imgSrc}')" class="text-emerald-600 hover:bg-emerald-50 p-2 rounded-lg transition" title="Ù…Ø´Ø§Ø±ÙƒØ©">
                            <i data-lucide="share-2" class="w-5 h-5"></i>
                        </button>
                    </div>
                </div>`;
            }

            grid.insertAdjacentHTML('beforeend', html);
            visibleGalleryCount = end;
            
            if (typeof lucide !== 'undefined') lucide.createIcons();
            
            if(typeof listenToLikes === 'function') {
                listenToLikes(visibleGalleryCount);
            }
        }

        function openGalleryLightbox(src) {
            const lb = document.getElementById('lightbox');
            const img = document.getElementById('lightbox-img');
            const dl = document.getElementById('lightbox-download');
            img.src = src;
            dl.href = src;
            lb.classList.remove('hidden');
            lb.classList.add('flex');
        }

        function closeLightbox() {
            const lb = document.getElementById('lightbox');
            lb.classList.add('hidden');
            lb.classList.remove('flex');
        }

        function shareGalleryImage(src) {
            const fullUrl = src.startsWith('http') ? src : window.location.origin + window.location.pathname.replace('gallery.html', '') + src;
            if (navigator.share) {
                navigator.share({ title: 'ØªØµÙ…ÙŠÙ… Ù…Ù† ÙƒÙ…Ø´ÙƒØ§Ø©', url: fullUrl }).catch(console.error);
            } else {
                navigator.clipboard.writeText(fullUrl);
                alert('ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©!');
            }
        }
    </script>
</body>
</html>